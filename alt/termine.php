<h1>Termine</h1><?php initTermine(); ?><?php termineList(); ?><br><script type='text/JavaScript' src='js/scw.js'></script><center> <?php  //include("calendarEnsemletermine.php"); ?></center><?phpfunction printAddFormular() {  if (hasCurrentUserRight("termine") && isset($_POST["aendern"])) {    $termin = getTerminById($_POST["terminid"], 1);    $aendern = true;  } else {    $aendern = false;  }?>    <form name="termineadd" method="post" action="<?php echo $_SERVER["PHP_SELF"] . "?" . $_SERVER['QUERY_STRING']; ?>" class="toggle" <?php if (!$aendern) { echo("style=\"display: none\""); } ?> >        <input type="hidden" name="terminid" value="<?php if ($aendern) { echo(htmlentities($termin->getTerminid())); } ?>">    <table align=center>      <tr>        <td> Datum von <small>(YYYY-MM-TT)</small>: </td>        <td> <input onclick='scwShow(this,event);' type="Text" name="DatumVonPrimary" value="<?php if ($aendern) { echo(htmlentities($termin->getVondateprimary())); } else { echo(""); } ?>" SIZE="40" MAXLENGTH="10"> </td>      </tr><tr>        <td> Datum bis <small>(YYYY-MM-TT)</small>: </td>        <td> <input onclick='scwShow(this,event);' type="Text" name="DatumBisPrimary" value="<?php if ($aendern) { echo(htmlentities($termin->getBisdateprimary())); } else { echo(""); } ?>" SIZE="40" MAXLENGTH="10"> </td>      </tr><tr>        <td> </td>        <td> <small>Bei eintätigen Events das selbe Datum wie <br>bei "Datum von" eingeben </small></td>    </tr><tr>        <td> Zeit von<small>(hh:mm)</small>: </td>        <td> <input type="Text" name="ZeitVonPrimary" value="<?php if ($aendern) { echo(formatTime(htmlentities($termin->getVontimeprimary()))); } else { echo("00:00"); } ?>" SIZE="40" MAXLENGTH="5"> </td>    </tr><tr>        <td> Zeit bis<small>(hh:mm)</small>: </td>        <td> <input type="Text" name="ZeitBisPrimary" value="<?php if ($aendern) { echo(formatTime(htmlentities($termin->getBistimeprimary()))); } else { echo("00:00"); } ?>" SIZE="40" MAXLENGTH="5"> </td>    </tr><tr>        <td> Was: </td>        <td> <input type="Text" name="Was" value="<?php if ($aendern) { echo(htmlentities(utf8_encode($termin->getWhat()))); } else { echo(""); } ?>" SIZE="40" MAXLENGTH="150"> </td>    </tr><tr>        <td> Wo: </td>        <td> <input type="Text" name="Wo" value="<?php if ($aendern) { echo(htmlentities(utf8_encode($termin->getWhere()))); } else { echo(""); } ?>" SIZE="40" MAXLENGTH="150"> </td>    </tr><tr>        <td> Infos: </td>        <td> <input type="Text" name="Infos" value="<?php if ($aendern) { echo(htmlentities(utf8_encode($termin->getInfos()))); } else { echo(""); } ?>" SIZE="40" MAXLENGTH="150"> </td>    </tr><tr>        <td> Termin Art: </td>        <td>            <select name="terminq" SIZE="2" style="width:25em" MAXLENGTH="150">                <option value="TERMIN" <?php if (!$aendern || $termin->getTerminq() == "TERMIN") echo("selected='selected'"); ?> >Termin</option>                <option value="PROBE" <?php if ($aendern && $termin->getTerminq() == "PROBE") echo("selected='selected'"); ?>>Probe</option>                <select>        </td>        </tr><tr>        <td></td>        <td>             <input type=submit name="<?php if ($aendern) { echo("update"); } else { echo("speichern"); } ?>"  value="<?php if ($aendern) { echo("  &Auml;nderung Speichern "); } else { echo("   Neu Speichern     "); } ?>" >             <input type=reset                   value="        Reset        ">        </td>      </tr>    </table>    <br>  </form><?php}function deleteTermin() {  if (hasCurrentUserRight("termine") && isset($_POST["loeschen"])) {      $sql = "delete from termin WHERE terminid=:terminid";      try {          $terminid = $_POST["terminid"];          $db = getDBPDO();          $stmt = $db->prepare($sql);          $stmt->bindParam("terminid", $terminid, PDO::PARAM_INT);          $stmt->execute();          if ($stmt->rowCount() == 1) {              $db = null;              return true;          } else {              $db = null;              return false;          }      } catch (PDOException $e) {          print_r($e);          return false;      }  }}function storeTermin() {        if (hasCurrentUserRight("termine") && (isset($_POST["speichern"]) || isset($_POST["update"]))) {            $termin = parseTerminFromRequest();            $sqlInsert = "INSERT INTO termin (terminq, vondateprimary, bisdateprimary, vontimeprimary, bistimeprimary, what, `where`, infos, createuserid, createdate) VALUES  \n" .                "(:terminq, :vondateprimary, :bisdateprimary, :vontimeprimary, :bistimeprimary, :what, :where, :infos, :createuserid, now())                            \n";                 $sqlUpdate = "UPDATE termin set            \n" .                     " vondateprimary = :vondateprimary,        \n" .                     " bisdateprimary = :bisdateprimary,        \n" .                     " vontimeprimary = :vontimeprimary,          \n" .                     " bistimeprimary = :bistimeprimary,          \n" .                     " what = :what,                  \n" .                     " infos = :infos,              \n" .                     " `where` = :where,                   \n" .                     " terminq = :terminq ,     \n" .                     " changeuserid = :changeuserid,\n" .                     " changedate = now()           \n" .                     "WHERE terminid = :terminid  \n";            try {                $db = getDBPDO();                if ($termin->getTerminid() > 0) {                    $stmt = $db->prepare($sqlUpdate);                } else {                    $stmt = $db->prepare($sqlInsert);                }                $datumVon = $termin->getVondateprimary();                $stmt->bindParam("vondateprimary", $datumVon);                $datumBis = $termin->getBisdateprimary();                $stmt->bindParam("bisdateprimary", $datumBis);                $zeitVon = $termin->getVontimeprimary();                $stmt->bindParam("vontimeprimary", $zeitVon);                $zeitBis = $termin->getBistimeprimary();                $stmt->bindParam("bistimeprimary", $zeitBis);                $was = $termin->getWhat();                $stmt->bindParam("what", $was, PDO::PARAM_STR);                $infos = $termin->getInfos();                $stmt->bindParam("infos", $infos, PDO::PARAM_STR);                $wo = $termin->getWhere();                $stmt->bindParam("where", $wo, PDO::PARAM_STR);                $qualifier = $termin->getTerminq();                $stmt->bindParam("terminq", $qualifier, PDO::PARAM_STR);                $currentuserId = $_SESSION['userid'];                if ($termin->getTerminid() > 0) {                    $terminid = $termin->getTerminid();                    $stmt->bindParam("terminid", $terminid, PDO::PARAM_INT);                    $stmt->bindParam("changeuserid", $currentuserId, PDO::PARAM_INT);                } else {                    $stmt->bindParam("createuserid", $currentuserId, PDO::PARAM_INT);                }                $stmt->execute();                if ($termin->getTerminid() <= 0) {                    $termin->setTerminid($db->lastInsertId());                }                if ($stmt->rowCount() == 1) {                    $db = null;                    return true;                } else {                    $db = null;                    return false;                }            } catch (PDOException $e) {                print_r($e);                return false;            }        }    }function initTermine() {  if (hasCurrentUserRight("termine")) { ?>     <script language="JavaScript" type="text/javascript">      function askDelete() {        if (confirm("Wirklich löschen")){          return true;        } else {          return false;        }       }    </script>    <script  type="text/javascript" >      jQuery(document).ready(function(){            jQuery("button").click(function () {          jQuery("form.toggle").slideToggle("slow");          jQuery("td.toggle").slideToggle("slow");          jQuery("th.toggle").slideToggle("slow");          jQuery("input.toggle").slideToggle("slow");        });      });    </script>    <center><button>Show/Hide Change Termin</button></center>    <br>    <?php      storeTermin();      deleteTermin();      printAddFormular();  }}function termineList() { ?>  <table cellpadding="0" cellspacing="0" border="0" align="center" style="width: 45em; margin: 0.1em auto;">    <tr class="tblhead">      <?php        if (hasCurrentUserRight("termine")) { ?>           <th style="border-top-left-radius:0.7em;border-bottom-left-radius:0.7em;" class="thclass" class="toggle"> </th>         <?php } ?>           <th style="border-top-left-radius:0.7em;border-bottom-left-radius:0.7em;" width="145">&nbsp;Datum</th>        <th>&nbsp;&nbsp;</th>        <th>Zeit</th>        <th>&nbsp;&nbsp;</th>        <th>Was</th>        <th>&nbsp;&nbsp;</th>        <th style="border-top-right-radius:0.7em;border-bottom-right-radius:0.7em;">Infos</th>      </tr>      <tr> <td colspan="*" height="3"> </td> </tr>       <?php       $termine = array();       $termine = array_merge($termine, getTermine(true, 0, "TERMIN"));       $termine = array_merge($termine, getTermine(true, 0, "PROBE"));       foreach($termine as $ensembletermin) { ?>	      <tr class="trclass">          <?php if (hasCurrentUserRight("termine")) {  ?>              <td class="tdclass" class="toggle">                   <form name="terminchange" method="post" action="<?php echo $_SERVER["PHP_SELF"] . "?" . $_SERVER['QUERY_STRING'];  ?>" >                     <input type=submit name="aendern" value="aendern" class="toggle buttonchange" style="display: none">                     <input type=submit name="loeschen" value="loeschen" class="toggle buttondelete" onClick="return askDelete()" style="display: none">                      <input type="hidden" name="terminid" value="<?php echo(htmlentities($ensembletermin->getTerminid()))?>">                  </form>              </td>           <?php } ?>  			            <td valign="top"> &nbsp;<?php echo($ensembletermin->getFormatedVonDatePrimary()); ?> </td>            <td> </td>            <td valign="top"> <?php echo($ensembletermin->getVontimeprimary()); ?> </td>            <td> </td>            <td valign="top">                <?php                     echo(htmlentities(utf8_encode($ensembletermin->getWhat())));                     if ($ensembletermin->getWhere() != "") {                        echo("<br><small>[" . $ensembletermin->getWhere() . "]</small>");                    }                ?>            </td>            <td> </td>            <td valign="top"><?php echo(htmlentities(utf8_encode($ensembletermin->getInfos()))); ?></td>	      </tr>        <tr> <td colspan="*" height="3"> </td> </tr>     <?php } ?>            </table> <?php}?>